\section{Translating equi-recursion to iso-recursion}

The set of syntactically valid expressions in the equi-recursive system is a
subset of the syntactically valid expressions in the iso-recursive system. A
simple one-to-one mapping, however, does not preserve well-typedness because
the target type system is more strict.

Instead, we describe a translation which uses a derivation tree to translate
from equi-recursive typed expressions to iso-recursive typed expressions. The
translation preserves well-typedness and the original and the resulting process
are \highlight{``wire-compatible''}. \js{what is the correct word?}
\pt{I've used that word, but the actual technical content is more
  tricky than I imagined.}

A derivation tree in the equi-recursive system with the overall conclusion
$\typing e T$ can be translated to the iso-recursive system. The function
$\llbracket \_ \rrbracket$ performs the translation; its argument is a full
derivation tree. $\derivTree e T$ describes the set of derivation trees with
the overall conclusion $\typing e T$.

\pt{A (perhaps simpler) alternative would be to use a translation
  judgment $\Gamma \vdash e \leadsto e' : T$ where (e.g.) $e$ is equi
  and $e'$ is iso. Only the conversion rule is interesting, as
  usual. Projecting on $e$ yields the equirecursive typing and
  projecting on $e'$ yields the isorecursive typing.}

\input{fig-translation}

% \begin{align*}
%   \dtransDef[\TUnit] \EUnit &= \EUnit &
%   \dtransDef x &= x \\
%   \dtransDef {\ELam x e} &= \ELam x \dtrans e &
%   \dtransDef {\ERec x e} &= \ERec x \dtrans e \\
%   \dtransDef {e_1 \; e_2} &= \dtrans{e_1} \; \dtrans{e_2} &
%   \dtransDef {\ELetU {e_1} {e_2}} &= \ELetU {\dtrans{e_1}} {\dtrans{e_2}} \\
%   \dtransDef {(e_1,e_2)} &= (\dtrans{e_1},\dtrans{e_2}) &
%   \dtransDef {\ELetP xy {e_1} {e_2}} &= \ELetP xy {\dtrans{e_1}} \dtrans{e_2} \\
% \end{align*}
% 
% \declrel{Typing derivation translation}
% \begin{mathpar}
%   \derivTransRule{ }{\typing \EUnit \TUnit}{\EUnit} \and
%   \derivTransRule{ }{\typing x T}{x} \and
%   
%   \derivTransRule{\DT e}{
%     \typing{\ELam x e}{U}
%   }{
%     \ELam x \derivTrans e
%   }
% 
%   \derivTransRule{\DT e}{
%     \typing{\ERec x e}{U}
%   }{
%     \ERec x \derivTrans e
%   }
% 
%   \derivTransRule{\DT {e_1} \\ \DT {e_2}}{
%     \typing[\CSplit]{e_1 e_2}{T_2}
%   }{
%     \derivTrans{e_1} \derivTrans{e_2}
%   }
% 
%   \derivTransRule{\DT {e_1} \\ \DT {e_2}}{
%     \typing{ \ELetU{e_1}{e_2} }{ T_2 }
%   }{
%     \ELetU {\derivTrans {e_1}} {\derivTrans {e_2}}
%   }
% 
%   \derivTransRule{\DT e \\ f : T \eqt U : f'}{
%     \typing e U
%   }{
%     f \; \derivTrans e
%   }
% \end{mathpar}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
