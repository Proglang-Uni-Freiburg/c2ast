\section{Iso-recursion}
\label{sec:iso-recursion}

The traditional equi-recursive system can---with very few and localized changes---be turned
into an iso-recursive system. The type syntax and dualization of
session types require no adjustments.

We extend the syntax with an extra expression to unroll a recursive
type,
\begin{align*}
    e \grmdef&
               \EUnroll e
\end{align*}
%
process reduction with an extra rule:
%
\begin{mathpar}
    % \reducerule{
    %   \PScope (\PPar* {\ERoll a} {\ERoll b})
    % }{
    %   \PPar* a b
    % }
    %   
    \reducerule{
      \PScope (\PPar* {\EUnroll a} {\EUnroll b})
    }{
      \PScope (\PPar* a b)
    }
\end{mathpar}
%
and we replace the typing rule for conversion by a rule for explicit unrolling:
\begin{mathpar}
  \inferrule{
    \typing{e}{\TRec S}
  }{
    \typing{\EUnroll e}{S[\TRec[X] S / X]}
  }
\end{mathpar}

The resulting system is much more tedious as the example from the
introduction demonstrates. Nevertheless, we can go forth and back
between the equirecursive system and the isorecursive system under
certain mild conditions.



\subsection{Expression typing}

\declrel{Typing contexts}
\begin{align*}
  \Ctxt \grmdef&
    \CNil \grmor \Ctxt, \CBind x T \grmor \Ctxt, \CBind* x T
\end{align*}

\declrel{Context exhaustion}[$\CExhausted$]
\begin{mathpar}
  \inferrule{ }{\CExhausted[\CNil]} \and
  \inferrule{\CExhausted}{\CExhausted[\Ctxt, \CBind* x T]}
\end{mathpar}

\declrel{Context splitting}[$\Ctxt = \CSplit[\Ctxt][\Ctxt]$]
\begin{mathpar}
  \inferrule{}{\cdot = \CSplit[\cdot][\cdot]} \and
  \inferrule{\Ctxt = \CSplit}{\Ctxt, \CBind  x T = \CSplit[(\Ctxt_1 , \CBind  x T)][ \Ctxt_2               ]} \and
  \inferrule{\Ctxt = \CSplit}{\Ctxt, \CBind  x T = \CSplit[ \Ctxt_ 1              ][(\Ctxt_2 , \CBind  x T)]} \and
  \inferrule{\Ctxt = \CSplit}{\Ctxt, \CBind* x T = \CSplit[(\Ctxt_1 , \CBind* x T)][(\Ctxt_2 , \CBind* x T)]}
\end{mathpar}

\input{fig-typing}

% Typing of expressions in the iso-recursive system is largely the same as for
% expressions in the equi-recursive system. As the only change, two additional
% typing rules are introduced concerned with $\EkwRoll$ and $\EkwUnroll$.
% \begin{mathpar}
%   \inferrule{
%     \typing{e}{S[\TRec[X] S / X]}
%   }{
%     \typing{\ERoll e}{\TRec S}
%   }
% 
%   \inferrule{
%     \typing{e}{\TRec S}
%   }{
%     \typing{\EUnroll e}{S[\TRec[X] S / X]}
%   }
% \end{mathpar}

% Evaluation contexts for the iso-recursive system have the same shape as the
% contexts in the equi-recursive system. The reduction relation is extended by
% two rules concerned with $\EkwRoll$ and $\EkwUnroll$.
% \begin{mathpar}
%   \reducerule{
%     \PScope (\PPar {E[\ERoll a]} {p})
%   }{
%     \PScope (\PPar {E[a]} {p})
%   }
% 
%   \reducerule{
%     \PScope (\PPar {E[\EUnroll a]} {p})
%   }{
%     \PScope (\PPar {E[a]} {p})
%   }
% \end{mathpar}
% Dual $\PScope[b,a]$ rules omitted.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
